<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>

        const apps = [ // name, url
            ["Discord", "https://discord.com/channels/@me"],
            ["YouTube", "https://www.youtube.com/"],
            ["YouTube Music", "https://music.youtube.com/"],

            ["studip", "https://studip.uni-rostock.de"],
            ["Uni Email", "https://email.uni-rostock.de"],
            ["Uni lsf", "https://lsf.uni-rostock.de"],
            ["mail", "https://mail.proton.me/"],

            ["Cloudflare", "https://dash.cloudflare.com/"],
            ["Groq", "https://groq.com/"],
            ["Hetzner Console", "https://console.hetzner.cloud/"],
            ["Wolfram Alpha", "https://www.wolframalpha.com/"],
            

            ["CardTrader", "https://www.cardtrader.com/"],
            ["Scryfall", "https://Scryfall.com/"],
            ["EDHREC", "https://edhrec.com/"],
            ["Archidekt", "https://archidekt.com/"],
            ["MTGPrint", "https://mtgprint.net/"],

            ["1337x", "https://1337x.to/"],
            ["PirateBay", "https://thepiratebay.org/"],
            ["Reapck Games", "https://repack-games.com/#"]
        ]

        function vpn_is_active() {
            let ip = ""

            let xhr = new XMLHttpRequest();
            xhr.open("GET", "https://checkip.amazonaws.com/", false);
            xhr.send();
            ip = xhr.responseText;

            xhr.open("GET", "/is_vpn?ip=" + ip, false);
            xhr.send();
            let data = JSON.parse(xhr.responseText);

            if (data.is_vpn) {
                return true;
            } else {
                return false;
            }
        }

        function update_vpn_status() {
            let status = document.getElementById("vpn_status");

            if (vpn_is_active()) {
                status.innerHTML = "VPN is active";
                status.classList.add("active");
                status.classList.remove("inactive");
            } else {
                status.innerHTML = "VPN is inactive";
                status.classList.add("inactive");
                status.classList.remove("active");
            }
        }

        function is_url(str) {
            let url_pattern = new RegExp("^(http|https)://", "i");
            return url_pattern.test(str);
        }

        function init_search_providers() {
            let search_providers = document.getElementsByClassName("search-provider");

            for (let i = 0; i < search_providers.length; i++) {
                let provider = search_providers[i];

                provider.addEventListener("click", function() {
                    let query = document.getElementById("search").value;
                    let is_safe = provider.getAttribute("x-is-safe");

                    let url = provider.getAttribute("x-url").replace("[QUERY]", query);
                    
                    if (is_url(query)) {
                        url = query;
                    }

                    if (!vpn_is_active() && is_safe == "false") {
                        alert("You need to activate your VPN to access this search engine");
                        return;
                    }

                    window.location.href = url;
                });
            }

            document.getElementById("search_button").addEventListener("click", function() {
                let query = document.getElementById("search").value;

                let url = search_providers[0].getAttribute("x-url").replace("[QUERY]", query);

                if (is_url(query)) {
                    url = query;
                }

                window.location.href = url;
            });

            document.getElementById("search").addEventListener("keyup", function(event) {
                if (event.keyCode === 13) {
                    // enter key
                    let query = document.getElementById("search").value;
                    
                    let url = search_providers[0].getAttribute("x-url").replace("[QUERY]", query);

                    if (is_url(query)) {
                        url = query;
                    }

                    window.location.href = url;
                } else {
                    update_search_predictions();
                }
            });
            
            // set the search bar to focus
            document.getElementById("search").focus();
        }

        async function update_search_predictions() {
            let query = document.getElementById("search").value;

            let predictions_div = document.getElementById("search-predictions");

            // predictions are made up of up to three apps (if the match the query) and then web results

            let predictions = [];

            for (let i = 0; i < apps.length; i++) {
                let app = apps[i];

                if (app[0].toLowerCase().includes(query.toLowerCase()) || app[1].toLowerCase().includes(query.toLowerCase())) {
                    predictions.push(["Open " + app[0], app[1]]);
                }
            }

            // add web results
            var url = "/web_autocomplete?q=" + query;

            let response = await fetch(url);
            let data = await response.json();

            for (let i = 0; i < data.length; i++) {
                let prediction = data[i];
                let phrase = prediction.phrase;
                predictions.push(["Search for " + phrase, "https://DuckDuckGo.com/?q=" + phrase]);
            }

            predictions_div.innerHTML = "";

            for (let i = 0; i < predictions.length; i++) {
                let prediction = predictions[i];

                let prediction_div = document.createElement("div");
                prediction_div.classList.add("search-prediction");
                prediction_div.innerHTML = prediction[0];
                prediction_div.addEventListener("click", function() {
                    window.location.href = prediction[1];
                });

                predictions_div.appendChild(prediction_div);
            }

        }

        document.addEventListener("DOMContentLoaded", function() {
            init_search_providers();
            update_vpn_status();
        });

    </script>

    <style>
body {
  font-family: 'Open Sans', sans-serif;
  font-size: 16px;
  line-height: 1.5;
  color: #333;
  background-color: #f9f9f9;
  margin: 0;
  padding: 0;
}

h1, h2, h3, h4, h5, h6 {
  font-weight: 700;
  color: #333;
  margin-top: 0;
}

h1 {
  font-size: 36px;
}

h2 {
  font-size: 24px;
}

h3 {
  font-size: 18px;
}

h4 {
  font-size: 16px;
}

h5 {
  font-size: 14px;
}

h6 {
  font-size: 12px;
}

a {
  text-decoration: none;
  color: #337ab7;
}

a:hover {
  color: #23527c;
}

#vpn_status {
  padding: 20px;
  background-color: #f7f7f7;
  border: 1px solid #ddd;
  border-radius: 4px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  text-align: center;
}

#vpn_status.active {
  background-color: #4CAF50;
  color: #fff;
}

#vpn_status.inactive {
  background-color: #ff0000;
  color: #fff;
}

#search-inputs {
  margin-top: 40px;
  text-align: center;
}

#search-inputs input[type="text"] {
  padding: 10px;
  font-size: 16px;
  width: 45vw;
  height: 40px;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

#search-inputs button[type="button"] {
  padding: 10px;
  font-size: 16px;
  width: 15%;
  height: 40px;
  background-color: #4CAF50;
  color: #fff;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

#search-inputs button[type="button"]:hover {
  background-color: #3e8e41;
}

#search-predictions {
  margin-top: 20px;
  padding: 20px;
  border: 1px solid #ddd;
  border-radius: 4px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  overflow-y: auto;
    max-height: 40vh;
    max-width: 50vw;
}

.search-prediction {
  padding: 10px;
  margin: 10px;
  background-color: #f7f7f7;
  border-bottom: 1px solid #ddd;
  cursor: pointer;
}

.search-prediction:hover {
  background-color: #f0f0f0;
}

#search-engines {
  margin-top: 40px;
  text-align: center;
}

.search-provider {
  display: inline-block;
  margin: 10px;
  padding: 10px;
  background-color: #f7f7f7;
  border: 1px solid #ddd;
  border-radius: 4px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  cursor: pointer;
}

.search-provider:hover {
  background-color: #f0f0f0;
}

    </style>

    <div id="vpn_status"></div>


    <div id="search-inputs">
        <input type="text" id="search" placeholder="Search">
        <button id="search_button">Search</button>
    </div>

    <div id="search-predictions">
        <div class="search-prediction">
            Prediction 1
        </div>

        <div class="search-prediction">
            Prediction 2
        </div>
    </div>


    <div id="search-engines">

        <div class="search-provider" id="duckduckgo" x-url="https://duckduckgo.com/?q=[QUERY]" x-is-safe="true">
            DuckDuckGo
        </div>

        <div class="search-provider" id="google" x-url="https://www.google.com/search?q=[QUERY]" x-is-safe="true">
            Google
        </div>

        <div class="search-provider" id="bing" x-url="https://www.bing.com/search?q=[QUERY]" x-is-safe="true">
            Bing
        </div>

        <div class="search-provider" id="the_pirate_bay" x-url="https://thepiratebay.org/search/[QUERY]/0/99/0" x-is-safe="false">
            The Pirate Bay
        </div>


    </div>

</body>
</html>